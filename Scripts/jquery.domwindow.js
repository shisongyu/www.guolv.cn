(function(a){a.fn.closeDOMWindow=function(c){if(!c){c={}}var b=function(f){if(c.anchoredClassName){var d=a("."+c.anchoredClassName);d.fadeOut("fast",function(){if(a.fn.draggable){d.trigger("unload").remove()}else{d.trigger("unload").remove()}});if(c.functionCallOnClose){c.functionCallAfterClose()}}else{var g=a("#DOMWindowOverlay");var e=a("#DOMWindow");g.fadeOut("fast",function(){g.trigger("unload").unbind().remove()});e.fadeOut("fast",function(){if(a.fn.draggable){e.trigger("unload").remove()}else{e.trigger("unload").remove()}});a(window).unbind("scroll.DOMWindow");a(window).unbind("resize.DOMWindow");if(a.fn.openDOMWindow.isIE6){a("#DOMWindowIE6FixIframe").remove()}if(c.functionCallOnClose){c.functionCallAfterClose()}}};if(c.eventType){return this.each(function(d){a(this).bind(c.eventType,function(){b(this);return false})})}else{b()}};a.closeDOMWindow=function(b){a.fn.closeDOMWindow(b)};a.fn.openDOMWindow=function(g){var d=a.fn.openDOMWindow;d.defaultsSettings={anchoredClassName:"",anchoredSelector:"",borderColor:"#ccc",borderSize:"4",draggable:0,eventType:null,fixedWindowY:100,functionCallOnOpen:null,functionCallOnClose:null,loader:0,loaderHeight:0,loaderImagePath:"",loaderWidth:0,modal:0,overlay:1,positionLeft:0,positionTop:0,positionType:"centered",windowBGColor:"#fff",windowBGImage:null,windowHTTPType:"get",windowPadding:10,windowSource:"inline",windowSourceID:"",windowSourceURL:"",windowSourceAttrURL:"href",browserType:""};var c=a.extend({},a.fn.openDOMWindow.defaultsSettings,g||{});d.viewPortHeight=function(){return self.innerHeight||document.documentElement.clientHeight||document.body.clientHeight};d.viewPortWidth=function(){return self.innerWidth||document.documentElement.clientWidth||document.body.clientWidth};d.scrollOffsetHeight=function(){return self.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop};d.scrollOffsetWidth=function(){return self.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft};d.isIE6=typeof document.body.style.maxHeight==="undefined";var j=function(){var n=a("#DOMWindowOverlay");if(d.isIE6){var o=document.documentElement.offsetHeight+document.documentElement.scrollTop-4;var m=document.documentElement.offsetWidth-21;n.css({height:o+"px",width:m+"px"})}else{n.css({height:"100%",width:"100%",position:"fixed"})}};var h=function(){var n=document.documentElement.offsetHeight+document.documentElement.scrollTop-4;var m=document.documentElement.offsetWidth-21;a("#DOMWindowIE6FixIframe").css({height:n+"px",width:m+"px"})};var e=function(){var m=a("#DOMWindow");if(c.height+50>d.viewPortHeight()){m.css("left",Math.round(d.viewPortWidth()/2)+d.scrollOffsetWidth()-Math.round((m.outerWidth())/2))}else{m.css("left",Math.round(d.viewPortWidth()/2)+d.scrollOffsetWidth()-Math.round((m.outerWidth())/2));m.css("top",Math.round(d.viewPortHeight()/2)+d.scrollOffsetHeight()-Math.round((m.outerHeight())/2))}};var i=function(){var m=a("#DOMWindowLoader");if(d.isIE6){m.css({left:Math.round(d.viewPortWidth()/2)+d.scrollOffsetWidth()-Math.round((m.innerWidth())/2),position:"absolute"});m.css({top:Math.round(d.viewPortHeight()/2)+d.scrollOffsetHeight()-Math.round((m.innerHeight())/2),position:"absolute"})}else{m.css({left:"50%",top:"50%",position:"fixed"})}};var b=function(){var m=a("#DOMWindow");m.css("left",c.positionLeft+d.scrollOffsetWidth());m.css("top",+c.positionTop+d.scrollOffsetHeight())};var k=function(m){if(arguments[0]){a("."+m+" #DOMWindowLoader").remove();a("."+m+" #DOMWindowContent").fadeIn("fast",function(){if(c.functionCallOnOpen){c.functionCallOnOpen()}});a("."+m+".closeDOMWindow").click(function(){a.closeDOMWindow();return false})}else{a("#DOMWindowLoader").remove();a("#DOMWindow").fadeIn("fast",function(){if(c.functionCallOnOpen){c.functionCallOnOpen()}});a("#DOMWindow .closeDOMWindow").click(function(){a.closeDOMWindow();return false})}};var f=function(n){var m={};n.replace(/b([^&=]*)=([^&=]*)b/g,function(p,o,q){if(typeof m[o]!="undefined"){m[o]+=","+q}else{m[o]=q}});return m};var l=function(x){c.windowSourceID=a(x).attr("href")||c.windowSourceID;c.windowSourceURL=a(x).attr(c.windowSourceAttrURL)||c.windowSourceURL;c.windowBGImage=c.windowBGImage?"background-image:url("+c.windowBGImage+")":"";var m,v;if(c.positionType=="anchored"){var w=a(c.anchoredSelector).position();var u=w.left+c.positionLeft;var n=w.top+c.positionTop;a("body").append('<div class="'+c.anchoredClassName+'" style="'+c.windowBGImage+";background-repeat:no-repeat;padding:"+c.windowPadding+"px;overflow:auto;position:absolute;top:"+n+"px;left:"+u+"px;height:"+c.height+"px;width:"+c.width+"px;background-color:"+c.windowBGColor+";border:"+c.borderSize+"px solid "+c.borderColor+';z-index:10001"><div id="DOMWindowContent" style="display:none"></div></div>');if(c.loader&&c.loaderImagePath!==""){a("."+c.anchoredClassName).append('<div id="DOMWindowLoader" style="width:'+c.loaderWidth+"px;height:"+c.loaderHeight+'px;"><img src="'+c.loaderImagePath+'" /></div>')}if(a.fn.draggable){if(c.draggable){a("."+c.anchoredClassName).draggable({cursor:"move"})}}switch(c.windowSource){case"inline":a("."+c.anchoredClassName+" #DOMWindowContent").append(a(c.windowSourceID).children());a("."+c.anchoredClassName).unload(function(){a("."+c.windowSourceID).append(a("."+c.anchoredClassName+" #DOMWindowContent").children())});k(c.anchoredClassName);break;case"iframe":a("."+c.anchoredClassName+" #DOMWindowContent").append('<iframe frameborder="0" hspace="0" wspace="0" src="'+c.windowSourceURL+'" name="DOMWindowIframe'+Math.round(Math.random()*1000)+'" style="width:100%;height:100%;border:none;background-color:#fff;" class="'+c.anchoredClassName+'Iframe" ></iframe>');a("."+c.anchoredClassName+"Iframe").load(k(c.anchoredClassName));break;case"ajax":if(c.windowHTTPType=="post"){if(c.windowSourceURL.indexOf("?")!==-1){m=c.windowSourceURL.substr(0,c.windowSourceURL.indexOf("?"));v=f(c.windowSourceURL)}else{m=c.windowSourceURL;v={}}a("."+c.anchoredClassName+" #DOMWindowContent").load(m,v,function(){k(c.anchoredClassName)})}else{if(c.windowSourceURL.indexOf("?")==-1){c.windowSourceURL+="?"}a("."+c.anchoredClassName+" #DOMWindowContent").load(c.windowSourceURL+"&random="+(new Date().getTime()),function(){k(c.anchoredClassName)})}break}}else{if(c.overlay){a("body").append('<div id="DOMWindowOverlay" style="z-index:10000;display:none;position:absolute;top:0;left:0;background-color:#FFF;filter:alpha(opacity=0);-moz-opacity: 0;opacity: 0;"></div>');if(d.isIE6){a("body").append('<iframe id="DOMWindowIE6FixIframe"  style="width:100%;height:100%;z-index:9999;position:absolute;top:0;left:0;filter:alpha(opacity=0);"></iframe>');h()}j();var t=a("#DOMWindowOverlay");t.fadeIn("fast");if(!c.modal){t.click(function(){a.closeDOMWindow()})}}if(c.loader&&c.loaderImagePath!==""){a("body").append('<div id="DOMWindowLoader" style="z-index:10002;width:'+c.loaderWidth+"px;height:"+c.loaderHeight+'px;"><img src="'+c.loaderImagePath+'" /></div>');i()}a("body").append('<div id="DOMWindow" style="background-repeat:no-repeat;'+c.windowBGImage+";overflow:auto;padding:"+c.windowPadding+"px;display:none;height:"+c.height+"px;width:"+c.width+"px;background-color:"+c.windowBGColor+";border:"+c.borderSize+"px solid "+c.borderColor+'; position:absolute;z-index:19000001"></div>');var s=a("#DOMWindow");switch(c.positionType){case"centered":e();if(c.height+50>d.viewPortHeight()){s.css("top",(c.fixedWindowY+d.scrollOffsetHeight())-2+"px")}break;case"absolute":s.css({top:(c.positionTop+d.scrollOffsetHeight())-2+"px",left:(c.positionLeft+d.scrollOffsetWidth())+4+"px"});if(a.fn.draggable){if(c.draggable){s.draggable({cursor:"move"})}}break;case"fixed":b();break;case"anchoredSingleWindow":var w=a(c.anchoredSelector).position();if(c.browserType=="index"){var r=document.getElementById(c.windowSourceID);var o=r.offsetLeft;while(r=r.offsetParent){o+=r.offsetLeft}var p=document.getElementById(c.windowSourceID);var q=p.offsetTop;q+=p.offsetHeight;while(p=p.offsetParent){q+=p.offsetTop}var u=o;var n=q;if(c.positionTop){n=c.positionTop}s.css({top:n+"px",left:u+"px"})}else{var u=w.left+c.positionLeft;var n=w.top+c.positionTop;s.css({top:n-2+"px",left:u+4+"px"})}break;case"hotelWindow":var u=c.positionLeft;var n=c.positionTop;if(c.browserType=="7"){s.css({top:n+4+"px",left:u+10+"px"})}else{s.css({top:n-2+"px",left:u+4+"px"})}}a(window).bind("scroll.DOMWindow",function(){if(c.overlay){j()}if(d.isIE6){h()}if(c.positionType=="centered"){e()}if(c.positionType=="fixed"){b()}});a(window).bind("resize.DOMWindow",function(){if(d.isIE6){h()}if(c.overlay){j()}if(c.positionType=="centered"){e()}});switch(c.windowSource){case"inline":s.append(a(c.windowSourceID).children());s.unload(function(){a(c.windowSourceID).append(s.children())});k();break;case"iframe":s.append('<iframe frameborder="0" hspace="0" wspace="0" src="'+c.windowSourceURL+'" name="DOMWindowIframe'+Math.round(Math.random()*1000)+'" style="width:100%;height:100%;border:none;background-color:#fff;" id="DOMWindowIframe" ></iframe>');a("#DOMWindowIframe").load(k());break;case"ajax":if(c.windowHTTPType=="post"){if(c.windowSourceURL.indexOf("?")!==-1){m=c.windowSourceURL.substr(0,c.windowSourceURL.indexOf("?"));v=f(c.windowSourceURL)}else{m=c.windowSourceURL;v={}}s.load(m,v,function(){k()})}else{if(c.windowSourceURL.indexOf("?")==-1){c.windowSourceURL+="?"}s.load(c.windowSourceURL+"&random="+(new Date().getTime()),function(){k()})}break}}};if(c.eventType){return this.each(function(m){a(this).bind(c.eventType,function(){l(this);return false})})}else{l()}};a.openDOMWindow=function(b){a.fn.openDOMWindow(b)}})(jQuery);